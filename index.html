<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³å£°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            max-width: 500px;
            width: 90vw;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .music-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }
        
        .title {
            font-size: 28px;
            margin-bottom: 20px;
            font-weight: 300;
        }
        
        .status {
            font-size: 18px;
            margin: 25px 0;
            padding: 15px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .controls {
            margin: 30px 0;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .controls.visible {
            opacity: 1;
        }
        
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .btn.stop {
            background: #f44336;
        }
        
        .btn.stop:hover {
            background: #d32f2f;
        }
        
        .hidden-audio {
            position: absolute;
            left: -9999px;
            opacity: 0;
        }
        
        .success-message {
            background: rgba(76, 175, 80, 0.3);
            color: #c8e6c9;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }
        
        .footer {
            margin-top: 30px;
            opacity: 0.8;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container" onclick="handleUserInteraction()">
        <div class="music-icon" id="musicIcon">ğŸµ</div>
        <h1 class="title">éŸ³å£°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h1>
        
        <div class="status" id="status">
            <span class="loading" id="loading"></span>
            éŸ³å£°ã‚’æº–å‚™ä¸­...
        </div>
        
        <div class="success-message" id="successMsg">
            ğŸ‰ éŸ³å£°ãŒè‡ªå‹•å†ç”Ÿã•ã‚Œã¾ã—ãŸï¼
        </div>
        
        <div class="controls" id="controls">
            <button class="btn" id="playBtn" onclick="playAudio()">â–¶ å†ç”Ÿ</button>
            <button class="btn stop" id="stopBtn" onclick="stopAudio()">â¹ åœæ­¢</button>
        </div>
        
        <div class="footer">
            QRã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã„ãŸã ã<br>ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼
        </div>
    </div>
    
    <!-- è¤‡æ•°ã®éŸ³å£°è¦ç´ ã§ç¢ºå®Ÿæ€§ã‚’å‘ä¸Š -->
    <audio class="hidden-audio" id="mainAudio" preload="auto">
        <source src="./MenzuT-Kenshin.mp3" type="audio/mpeg">
    </audio>
    
    <audio class="hidden-audio" id="backupAudio" preload="auto">
        <source src="./MenzuT-Kenshin.mp3" type="audio/mpeg">
    </audio>

    <script>
        const mainAudio = document.getElementById('mainAudio');
        const backupAudio = document.getElementById('backupAudio');
        const status = document.getElementById('status');
        const loading = document.getElementById('loading');
        const musicIcon = document.getElementById('musicIcon');
        const controls = document.getElementById('controls');
        const successMsg = document.getElementById('successMsg');
        
        let audioReady = false;
        let isPlaying = false;
        let userHasInteracted = false;
        let autoplayAttempted = false;
        
        // éŸ³å£°è¨­å®š
        mainAudio.volume = 0.8;
        backupAudio.volume = 0.8;
        
        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«åˆæœŸåŒ–
        window.addEventListener('load', function() {
            console.log('ğŸµ éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹');
            setupAudioEvents();
            prepareForAutoplay();
        });
        
        function setupAudioEvents() {
            // ãƒ¡ã‚¤ãƒ³éŸ³å£°ã®æº–å‚™å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆ
            mainAudio.addEventListener('canplaythrough', function() {
                console.log('âœ… ãƒ¡ã‚¤ãƒ³éŸ³å£°æº–å‚™å®Œäº†');
                onAudioReady();
            });
            
            // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—éŸ³å£°ã®æº–å‚™å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆ
            backupAudio.addEventListener('canplaythrough', function() {
                console.log('âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—éŸ³å£°æº–å‚™å®Œäº†');
                if (!audioReady) {
                    onAudioReady();
                }
            });
            
            // å†ç”Ÿé–‹å§‹ã‚¤ãƒ™ãƒ³ãƒˆ
            mainAudio.addEventListener('play', function() {
                onPlayStart();
            });
            
            backupAudio.addEventListener('play', function() {
                onPlayStart();
            });
            
            // å†ç”Ÿçµ‚äº†ã‚¤ãƒ™ãƒ³ãƒˆ
            mainAudio.addEventListener('ended', function() {
                onPlayEnd();
            });
            
            backupAudio.addEventListener('ended', function() {
                onPlayEnd();
            });
            
            // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
            mainAudio.addEventListener('error', function(e) {
                console.error('ãƒ¡ã‚¤ãƒ³éŸ³å£°ã‚¨ãƒ©ãƒ¼:', e);
                tryBackupAudio();
            });
            
            backupAudio.addEventListener('error', function(e) {
                console.error('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—éŸ³å£°ã‚¨ãƒ©ãƒ¼:', e);
                showError();
            });
        }
        
        function prepareForAutoplay() {
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³æ¤œçŸ¥ã®æº–å‚™
            const interactionEvents = [
                'touchstart', 'touchend', 'touchmove',
                'mousedown', 'mouseup', 'click',
                'keydown', 'scroll'
            ];
            
            interactionEvents.forEach(event => {
                document.addEventListener(event, handleUserInteraction, {
                    once: true,
                    passive: true
                });
            });
        }
        
        function handleUserInteraction() {
            if (!userHasInteracted) {
                userHasInteracted = true;
                console.log('ğŸ‘† ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³æ¤œçŸ¥');
                
                if (audioReady && !autoplayAttempted) {
                    attemptAutoplay();
                }
            }
        }
        
        // éŸ³å£°æº–å‚™å®Œäº†æ™‚ã®å‡¦ç†ï¼ˆã“ã“ãŒé‡è¦ï¼ï¼‰
        function onAudioReady() {
            audioReady = true;
            console.log('ğŸ¯ éŸ³å£°æº–å‚™å®Œäº† - è‡ªå‹•å†ç”Ÿé–‹å§‹');
            
            hideLoading();
            status.innerHTML = 'ğŸµ éŸ³å£°æº–å‚™å®Œäº†ï¼';
            
            // æº–å‚™å®Œäº†ã®ç¬é–“ã«è‡ªå‹•å†ç”Ÿè©¦è¡Œ
            setTimeout(attemptAutoplay, 100);
            setTimeout(attemptAutoplay, 300);
            setTimeout(attemptAutoplay, 500);
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ—¢ã«æ“ä½œã—ã¦ã„ã‚‹å ´åˆã‚‚å³åº§ã«å†ç”Ÿ
            if (userHasInteracted) {
                attemptAutoplay();
            }
        }
        
        async function attemptAutoplay() {
            if (autoplayAttempted || !audioReady) return;
            
            console.log('ğŸš€ è‡ªå‹•å†ç”Ÿè©¦è¡Œä¸­...');
            autoplayAttempted = true;
            
            try {
                // ã¾ãšãƒ¡ã‚¤ãƒ³éŸ³å£°ã§è©¦è¡Œ
                const playPromise = mainAudio.play();
                
                if (playPromise !== undefined) {
                    await playPromise;
                    console.log('âœ… ãƒ¡ã‚¤ãƒ³éŸ³å£°è‡ªå‹•å†ç”ŸæˆåŠŸï¼');
                }
            } catch (error) {
                console.log('âš ï¸ ãƒ¡ã‚¤ãƒ³éŸ³å£°è‡ªå‹•å†ç”Ÿå¤±æ•—:', error.message);
                
                try {
                    // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—éŸ³å£°ã§å†è©¦è¡Œ
                    const backupPromise = backupAudio.play();
                    
                    if (backupPromise !== undefined) {
                        await backupPromise;
                        console.log('âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—éŸ³å£°è‡ªå‹•å†ç”ŸæˆåŠŸï¼');
                    }
                } catch (backupError) {
                    console.log('âŒ è‡ªå‹•å†ç”Ÿå®Œå…¨å¤±æ•—:', backupError.message);
                    showManualPlayOption();
                }
            }
        }
        
        function onPlayStart() {
            if (isPlaying) return;
            
            isPlaying = true;
            console.log('ğŸµ å†ç”Ÿé–‹å§‹');
            
            musicIcon.textContent = 'ğŸ”Š';
            status.innerHTML = 'ğŸµ éŸ³å£°å†ç”Ÿä¸­...';
            successMsg.style.display = 'block';
            controls.classList.add('visible');
            
            // èƒŒæ™¯è‰²ã‚’æˆåŠŸè‰²ã«å¤‰æ›´
            document.body.style.background = 'linear-gradient(135deg, #4CAF50 0%, #45a049 100%)';
        }
        
        function onPlayEnd() {
            isPlaying = false;
            console.log('ğŸ å†ç”Ÿçµ‚äº†');
            
            musicIcon.textContent = 'âœ…';
            status.innerHTML = 'å†ç”Ÿå®Œäº†ï¼';
            successMsg.innerHTML = 'ğŸ‰ éŸ³å£°ã®å†ç”ŸãŒå®Œäº†ã—ã¾ã—ãŸï¼';
        }
        
        function tryBackupAudio() {
            console.log('ğŸ”„ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—éŸ³å£°ã«åˆ‡ã‚Šæ›¿ãˆ');
            if (audioReady) {
                backupAudio.play().catch(error => {
                    console.error('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—éŸ³å£°ã‚‚å¤±æ•—:', error);
                    showError();
                });
            }
        }
        
        function showManualPlayOption() {
            status.innerHTML = 'ğŸµ ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦å†ç”Ÿé–‹å§‹';
            controls.classList.add('visible');
        }
        
        function showError() {
            hideLoading();
            status.innerHTML = 'âŒ éŸ³å£°ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ';
            musicIcon.textContent = 'âŒ';
        }
        
        function hideLoading() {
            loading.style.display = 'none';
        }
        
        // æ‰‹å‹•å†ç”Ÿãƒœã‚¿ãƒ³
        function playAudio() {
            if (isPlaying) return;
            
            const audio = mainAudio.error ? backupAudio : mainAudio;
            
            audio.play().then(() => {
                console.log('ğŸ‘† æ‰‹å‹•å†ç”ŸæˆåŠŸ');
            }).catch(error => {
                console.error('æ‰‹å‹•å†ç”Ÿå¤±æ•—:', error);
                status.innerHTML = 'âŒ å†ç”Ÿã‚¨ãƒ©ãƒ¼: ' + error.message;
            });
        }
        
        function stopAudio() {
            mainAudio.pause();
            backupAudio.pause();
            mainAudio.currentTime = 0;
            backupAudio.currentTime = 0;
            
            isPlaying = false;
            musicIcon.textContent = 'ğŸµ';
            status.innerHTML = 'éŸ³å£°ã‚’åœæ­¢ã—ã¾ã—ãŸ';
            successMsg.style.display = 'none';
        }
        
        // ãƒ‡ãƒãƒƒã‚°æƒ…å ±
        console.log('ğŸµ ç¬é–“è‡ªå‹•å†ç”Ÿã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
        console.log('ğŸ“± ãƒ‡ãƒã‚¤ã‚¹:', navigator.userAgent);
    </script>
</body>
</html>
