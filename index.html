<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Èü≥Â£∞„É°„ÉÉ„Çª„Éº„Ç∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.15);
            padding: 40px 30px;
            border-radius: 20px;
            backdrop-filter: blur(15px);
            max-width: 400px;
            width: 90vw;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .pulse-circle {
            width: 120px;
            height: 120px;
            margin: 0 auto 30px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            animation: pulse 2s infinite;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
        }
        
        .pulse-circle:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 35px rgba(255, 107, 107, 0.5);
        }
        
        @keyframes pulse {
            0% { 
                transform: scale(1);
                box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
            }
            50% { 
                transform: scale(1.08);
                box-shadow: 0 15px 35px rgba(255, 107, 107, 0.6);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
            }
        }
        
        .title {
            font-size: 24px;
            margin-bottom: 15px;
            font-weight: 300;
            letter-spacing: 1px;
        }
        
        .status {
            font-size: 16px;
            margin: 20px 0;
            opacity: 0.9;
            min-height: 20px;
        }
        
        .tap-area {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            cursor: pointer;
        }
        
        .audio-hidden {
            position: absolute;
            left: -9999px;
            width: 1px;
            height: 1px;
            opacity: 0;
        }
        
        .controls {
            margin-top: 30px;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .controls.visible {
            opacity: 1;
        }
        
        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 5px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .footer-text {
            margin-top: 30px;
            font-size: 14px;
            opacity: 0.8;
            line-height: 1.4;
        }
        
        .loading-spinner {
            display: none;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* „É¢„Éê„Ç§„É´ÁâπÊúâ„ÅÆÊúÄÈÅ©Âåñ */
        @media (max-width: 480px) {
            .container {
                padding: 30px 20px;
                border-radius: 15px;
            }
            
            .pulse-circle {
                width: 100px;
                height: 100px;
                font-size: 35px;
            }
            
            .title {
                font-size: 20px;
            }
        }
        
        /* „Éï„É´„Çπ„ÇØ„É™„Éº„É≥„É¢„Éº„Éâ */
        .fullscreen-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .fullscreen-overlay.active {
            display: flex;
        }
        
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 30px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- „Éï„É´„Çπ„ÇØ„É™„Éº„É≥Èü≥Â£∞ÂÜçÁîüÈ†òÂüü -->
    <div class="tap-area" id="tapArea"></div>
    
    <div class="container" id="mainContainer">
        <div class="pulse-circle" id="playCircle">
            <span id="playIcon">üéµ</span>
        </div>
        
        <h1 class="title">Èü≥Â£∞„É°„ÉÉ„Çª„Éº„Ç∏</h1>
        <div class="status" id="status">ÁîªÈù¢„Çí„Çø„ÉÉ„Éó„Åó„Å¶ÂÜçÁîü</div>
        
        <div class="loading-spinner" id="loadingSpinner"></div>
        
        <div class="controls" id="controls">
            <button class="control-btn" id="playBtn" onclick="toggleAudio()">‚ñ∂ ÂÜçÁîü</button>
            <button class="control-btn" id="pauseBtn" onclick="pauseAudio()">‚è∏ ÂÅúÊ≠¢</button>
        </div>
        
        <div class="footer-text">
            QR„Ç≥„Éº„Éâ„Åã„Çâ„Ç¢„ÇØ„Çª„Çπ„Åó„Å¶„ÅÑ„Åü„Å†„Åç„ÄÅ<br>„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ
        </div>
    </div>
    
    <!-- Èö†„ÅóÈü≥Â£∞Ë¶ÅÁ¥†ÔºàË§áÊï∞„ÅÆ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºâ -->
    <audio class="audio-hidden" id="audioMain" preload="auto" crossorigin="anonymous">
        <source src="./MenzuT-Kenshin.mp3" type="audio/mpeg">
        <source src="MenzuT-Kenshin.mp3" type="audio/mpeg">
        <source src="./audio/MenzuT-Kenshin.mp3" type="audio/mpeg">
    </audio>
    
    <!-- „Éï„É´„Çπ„ÇØ„É™„Éº„É≥„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
    <div class="fullscreen-overlay" id="fullscreenOverlay">
        <button class="close-btn" onclick="closeFullscreen()">√ó</button>
        <div class="pulse-circle" style="margin-bottom: 30px;">
            <span>üéß</span>
        </div>
        <h2>Èü≥Â£∞„ÇíÂÜçÁîü‰∏≠...</h2>
    </div>

    <script>
        const audio = document.getElementById('audioMain');
        const status = document.getElementById('status');
        const playCircle = document.getElementById('playCircle');
        const playIcon = document.getElementById('playIcon');
        const controls = document.getElementById('controls');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const tapArea = document.getElementById('tapArea');
        const fullscreenOverlay = document.getElementById('fullscreenOverlay');
        
        let audioContext = null;
        let isPlaying = false;
        let audioReady = false;
        let userInteracted = false;
        let autoPlayTriggered = false;
        
        // ÊúÄÈÅ©Âåñ„Åï„Çå„Åü„Ç™„Éº„Éá„Ç£„Ç™Ë®≠ÂÆö
        audio.volume = 0.85;
        audio.preload = 'auto';
        
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÂÆå‰∫ÜÊôÇ
        window.addEventListener('load', function() {
            initializeAudio();
            setupInteractionListeners();
            
            // ÊÆµÈöéÁöÑËá™ÂãïÂÜçÁîüË©¶Ë°å
            setTimeout(tryImmediateAutoPlay, 100);
            setTimeout(tryDelayedAutoPlay, 300);
            setTimeout(showReadyState, 1000);
        });
        
        function initializeAudio() {
            // Èü≥Â£∞„Ç≥„É≥„ÉÜ„Ç≠„Çπ„Éà„ÅÆÊ∫ñÂÇô
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.log('AudioContext not supported');
            }
            
            // Èü≥Â£∞„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
            audio.addEventListener('canplaythrough', function() {
                audioReady = true;
                hideLoading();
                updateStatus('üéµ „Çø„ÉÉ„Éó„ÅßÈü≥Â£∞„ÇíÂÜçÁîü');
                playIcon.textContent = 'üéµ';
            });
            
            audio.addEventListener('play', function() {
                isPlaying = true;
                playIcon.textContent = 'üîä';
                updateStatus('üéµ ÂÜçÁîü‰∏≠...');
                controls.classList.add('visible');
                showFullscreen();
            });
            
            audio.addEventListener('pause', function() {
                isPlaying = false;
                playIcon.textContent = 'üéµ';
                updateStatus('Èü≥Â£∞„ÇíÂÅúÊ≠¢„Åó„Åæ„Åó„Åü');
                hideFullscreen();
            });
            
            audio.addEventListener('ended', function() {
                isPlaying = false;
                playIcon.textContent = '‚úÖ';
                updateStatus('ÂÜçÁîüÂÆå‰∫ÜÔºÅ');
                hideFullscreen();
            });
            
            audio.addEventListener('error', function(e) {
                hideLoading();
                playIcon.textContent = '‚ùå';
                updateStatus('Èü≥Â£∞Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº');
                console.error('Audio error:', e);
            });
        }
        
        function setupInteractionListeners() {
            // „ÅÇ„Çâ„ÇÜ„Çã„É¶„Éº„Ç∂„ÉºÊìç‰Ωú„ÇíÊ§úÁü•
            const interactionEvents = [
                'touchstart', 'touchend', 'touchmove',
                'mousedown', 'mouseup', 'mousemove',
                'click', 'keydown', 'scroll',
                'gesturestart', 'gesturechange', 'gestureend'
            ];
            
            interactionEvents.forEach(event => {
                document.addEventListener(event, handleFirstInteraction, {
                    once: true,
                    passive: true,
                    capture: true
                });
            });
            
            // „Çø„ÉÉ„Éó„Ç®„É™„Ç¢„ÅÆË®≠ÂÆö
            tapArea.addEventListener('click', handleTapToPlay);
            playCircle.addEventListener('click', handleTapToPlay);
            
            // „É¢„Éê„Ç§„É´ÁâπÊúâ„ÅÆ„Ç§„Éô„É≥„Éà
            window.addEventListener('orientationchange', function() {
                setTimeout(tryAutoPlay, 100);
            });
            
            // „Éö„Éº„Ç∏„Éï„Ç©„Éº„Ç´„Çπ
            window.addEventListener('focus', function() {
                if (!autoPlayTriggered) {
                    setTimeout(tryAutoPlay, 50);
                }
            });
        }
        
        function handleFirstInteraction() {
            userInteracted = true;
            
            // AudioContext„ÅÆÂÜçÈñã
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume().then(() => {
                    console.log('AudioContext resumed');
                });
            }
            
            // Â∞ë„ÅóÈÅÖÂª∂„Åó„Å¶„Åã„ÇâËá™ÂãïÂÜçÁîü
            setTimeout(tryAutoPlay, 50);
        }
        
        function handleTapToPlay(e) {
            e.preventDefault();
            e.stopPropagation();
            
            if (!audioReady) {
                showLoading();
                updateStatus('Èü≥Â£∞„ÇíÊ∫ñÂÇô‰∏≠...');
                return;
            }
            
            playAudio();
        }
        
        function tryImmediateAutoPlay() {
            if (audioReady) {
                tryAutoPlay();
            }
        }
        
        function tryDelayedAutoPlay() {
            if (!autoPlayTriggered && audioReady) {
                tryAutoPlay();
            }
        }
        
        function tryAutoPlay() {
            if (autoPlayTriggered || !audioReady) return;
            
            const playPromise = audio.play();
            
            if (playPromise) {
                playPromise.then(() => {
                    autoPlayTriggered = true;
                    console.log('Auto-play successful');
                }).catch(error => {
                    console.log('Auto-play prevented:', error.message);
                    // Ëá™ÂãïÂÜçÁîüÂ§±ÊïóÊôÇ„ÅÆË¶ñË¶öÁöÑ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
                    playCircle.style.animation = 'pulse 1.5s infinite';
                });
            }
        }
        
        function playAudio() {
            if (!audioReady) return;
            
            showLoading();
            
            const playPromise = audio.play();
            
            if (playPromise) {
                playPromise.then(() => {
                    hideLoading();
                    autoPlayTriggered = true;
                    tapArea.style.display = 'none'; // „Çø„ÉÉ„Éó„Ç®„É™„Ç¢„ÇíÈùûË°®Á§∫
                }).catch(error => {
                    hideLoading();
                    updateStatus('ÂÜçÁîü„Ç®„É©„Éº: ' + error.message);
                    console.error('Play error:', error);
                });
            }
        }
        
        function toggleAudio() {
            if (isPlaying) {
                audio.pause();
            } else {
                playAudio();
            }
        }
        
        function pauseAudio() {
            audio.pause();
        }
        
        function showReadyState() {
            if (!audioReady && !autoPlayTriggered) {
                updateStatus('üéµ ÁîªÈù¢„Çí„Çø„ÉÉ„Éó„Åó„Å¶ÂÜçÁîüÈñãÂßã');
                playCircle.style.animation = 'pulse 2s infinite';
            }
        }
        
        function showLoading() {
            loadingSpinner.style.display = 'block';
        }
        
        function hideLoading() {
            loadingSpinner.style.display = 'none';
        }
        
        function updateStatus(message) {
            status.textContent = message;
        }
        
        function showFullscreen() {
            if (window.innerWidth <= 768) { // „É¢„Éê„Ç§„É´„Åß„ÅÆ„ÅøË°®Á§∫
                fullscreenOverlay.classList.add('active');
            }
        }
        
        function hideFullscreen() {
            fullscreenOverlay.classList.remove('active');
        }
        
        function closeFullscreen() {
            hideFullscreen();
            pauseAudio();
        }
        
        // „É¢„Éê„Ç§„É´„Éñ„É©„Ç¶„Ç∂ÁâπÊúâ„ÅÆÂØæÁ≠ñ
        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
            // iOS SafariÁî®„ÅÆÁâπÂà•„Å™Ë®≠ÂÆö
            audio.load();
            
            // Web Audio API„Å´„Çà„ÇãËøΩÂä†ÊúÄÈÅ©Âåñ
            if (audioContext) {
                const source = audioContext.createMediaElementSource(audio);
                const gainNode = audioContext.createGain();
                source.connect(gainNode);
                gainNode.connect(audioContext.destination);
                gainNode.gain.value = 1.0;
            }
            
            // „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„ÉâÂÜçÁîüÂØæÂøú
            document.addEventListener('visibilitychange', function() {
                if (document.hidden && isPlaying) {
                    // „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„Åß„ÇÇÁ∂ôÁ∂öÂÜçÁîü
                    console.log('Background play mode');
                } else if (!document.hidden && !isPlaying) {
                    // „Éï„Ç©„Ç¢„Ç∞„É©„Ç¶„É≥„ÉâÂæ©Â∏∞ÊôÇ„ÅÆÂÜçÈñãË©¶Ë°å
                    setTimeout(tryAutoPlay, 100);
                }
            });
        }
        
        // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±ÔºàÊú¨Áï™„Åß„ÅØÂâäÈô§ÂèØËÉΩÔºâ
        console.log('Mobile audio system initialized');
        console.log('User agent:', navigator.userAgent);
        console.log('Audio support:', audio.canPlayType('audio/mpeg'));
    </script>
</body>
</html>
